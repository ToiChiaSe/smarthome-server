<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Smart Home Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <div class="container">
    <h1>Smart Home Dashboard</h1>

    <div class="top-bar">
      <span id="user-info">Chưa đăng nhập</span>
      <span id="clock" style="font-weight:bold;color:#4ade80"></span>
      <button class="logout-btn" onclick="logout()">Đăng xuất</button>
    </div>

    <!-- CẢM BIẾN -->
    <section class="card">
      <h2>Thông số cảm biến</h2>
      <div class="sensor-grid">
        <div class="sensor-box">
          <span>Nhiệt độ</span>
          <h3><span id="temp">--</span> °C</h3>
        </div>
        <div class="sensor-box">
          <span>Độ ẩm</span>
          <h3><span id="hum">--</span> %</h3>
        </div>
        <div class="sensor-box">
          <span>Ánh sáng</span>
          <h3><span id="lux">--</span> lux</h3>
        </div>
      </div>
    </section>

    <!-- TRẠNG THÁI THIẾT BỊ -->
    <section class="card">
      <h2>Trạng thái thiết bị</h2>
      <div class="status-grid">
        <div class="status-item"><span>LED1:</span> <span id="st-led1">--</span></div>
        <div class="status-item"><span>LED2:</span> <span id="st-led2">--</span></div>
        <div class="status-item"><span>LED3:</span> <span id="st-led3">--</span></div>
        <div class="status-item"><span>LED4:</span> <span id="st-led4">--</span></div>
        <div class="status-item"><span>Quạt:</span> <span id="st-fan">--</span></div>
        <div class="status-item"><span>Rèm:</span> <span id="st-curtain">--</span></div>
        <div class="status-item"><span>Auto Mode:</span> <span id="auto-mode-label">--</span></div>
        <div class="status-item"><span>Hành động cuối:</span> <span id="st-last">--</span></div>
      </div>
    </section>

    <!-- ĐIỀU KHIỂN LED + QUẠT -->
    <section class="card">
      <h2>Điều khiển đèn & quạt</h2>
      <div class="control-grid">
        <button id="btn-led1" class="ctrl-btn" onclick="toggleLed('led1')">LED 1</button>
        <button id="btn-led2" class="ctrl-btn" onclick="toggleLed('led2')">LED 2</button>
        <button id="btn-led3" class="ctrl-btn" onclick="toggleLed('led3')">LED 3</button>
        <button id="btn-led4" class="ctrl-btn" onclick="toggleLed('led4')">LED 4</button>
        <button id="btn-fan"  class="ctrl-btn wide" onclick="toggleFan()">Quạt</button>
      </div>
    </section>

    <!-- ĐIỀU KHIỂN RÈM -->
    <section class="card">
      <h2>Điều khiển rèm</h2>
      <div class="control-grid">
        <button id="btn-cur-open"  class="ctrl-btn" onclick="curtainCmd('OPEN')">Mở</button>
        <button id="btn-cur-stop"  class="ctrl-btn" onclick="curtainCmd('STOP')">Dừng</button>
        <button id="btn-cur-close" class="ctrl-btn" onclick="curtainCmd('CLOSE')">Đóng</button>
      </div>
      <p class="curtain-info">
        Trạng thái: <span id="curtain-mode-label">--</span> — 
        <span id="curtain-percent">-- %</span>
      </p>
    </section>

    <!-- AUTO MODE -->
    <section class="card">
      <h2>Chế độ tự động (Auto Mode)</h2>

      <h3 style="margin-top:20px">Cấu hình ngưỡng</h3>
      <div class="auto-grid">
        <label>Nhiệt độ min: <input id="tempMin" type="number"></label>
        <label>Nhiệt độ max: <input id="tempMax" type="number"></label>
        <label>Ánh sáng min: <input id="lightMin" type="number"></label>
        <label>Ánh sáng max: <input id="lightMax" type="number"></label>
        <label>Độ ẩm min: <input id="humMin" type="number"></label>
        <label>Độ ẩm max: <input id="humMax" type="number"></label>
      </div>

      <h3 style="margin-top:20px">Thời gian hoạt động</h3>
      <div class="auto-grid">
        <label>Hoạt động từ: <input id="activeFrom" type="time"></label>
        <label>Đến: <input id="activeTo" type="time"></label>
      </div>

      <h3 style="margin-top:20px">Danh sách Rule Auto</h3>
      <table id="autoRuleTable" class="auto-rule-table">
        <thead>
          <tr>
            <th>Thiết bị</th>
            <th>Cảm biến</th>
            <th>Điều kiện</th>
            <th>Hành động</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <button class="ctrl-btn" style="margin-top:10px" onclick="addAutoRule()">+ Thêm rule</button>

      <br><br>
      <button class="ctrl-btn wide" onclick="saveAutoConfig()">Lưu cấu hình</button>

      <h3 style="margin-top:20px">AutoMode đang chạy</h3>
      <p id="auto-running" style="font-weight:bold; color:#0077cc">--</p>
    </section>

    <!-- AUTO MODE LOG -->
    <section class="card">
      <h2>Lịch sử AutoMode</h2>
      <table id="autoLogTable">
        <thead>
          <tr>
            <th>Thời gian</th>
            <th>Rule</th>
            <th>Action</th>
            <th>Giá trị</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- SCHEDULE -->
    <section class="card">
      <h2>Lịch hoạt động (Schedule)</h2>

      <div class="form-grid-4">
        <select id="sch-device">
          <option value="led1">LED 1</option>
          <option value="led2">LED 2</option>
          <option value="led3">LED 3</option>
          <option value="led4">LED 4</option>
          <option value="fan">Quạt</option>
          <option value="curtain">Rèm</option>
        </select>

        <select id="sch-action">
          <option value="ON">ON / OPEN</option>
          <option value="OFF">OFF / CLOSE</option>
        </select>

        <input id="sch-time" type="time" />

        <select id="sch-repeat">
          <option value="daily">Hàng ngày</option>
          <option value="once">Một lần</option>
        </select>
      </div>

      <button class="ctrl-btn" onclick="addSchedule()">Thêm lịch</button>

      <table id="scheduleTable">
        <thead>
          <tr>
            <th>Thiết bị</th>
            <th>Hành động</th>
            <th>Thời gian</th>
            <th>Lặp lại</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- SCENARIO -->
    <section class="card">
      <h2>Kịch bản điều khiển (Scenario)</h2>

      <div class="form-grid-3">
        <input id="sc-name" type="text" placeholder="Tên kịch bản" />
        <input id="sc-tempAbove" type="number" placeholder="Temp > (°C)" />
        <input id="sc-tempBelow" type="number" placeholder="Temp < (°C)" />
      </div>

      <div class="form-grid-3">
        <input id="sc-lightAbove" type="number" placeholder="Light > (lux)" />
        <input id="sc-lightBelow" type="number" placeholder="Light < (lux)" />
        <input id="sc-humAbove" type="number" placeholder="Humidity > (%)" />
      </div>

      <div class="form-grid-3">
        <input id="sc-humBelow" type="number" placeholder="Humidity < (%)" />
        <select id="sc-device">
          <option value="led1">LED 1</option>
          <option value="led2">LED 2</option>
          <option value="led3">LED 3</option>
          <option value="led4">LED 4</option>
          <option value="fan">Quạt</option>
          <option value="curtain">Rèm</option>
        </select>
        <select id="sc-cmd">
          <option value="ON">ON / OPEN</option>
          <option value="OFF">OFF / CLOSE</option>
        </select>
      </div>

      <button class="ctrl-btn" onclick="addScenario()">Thêm kịch bản</button>

      <table id="scenarioTable">
        <thead>
          <tr>
            <th>Tên</th>
            <th>Điều kiện</th>
            <th>Hành động</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- BIỂU ĐỒ THỐNG KÊ -->
<section class="card">
  <h2>Biểu đồ</h2>

  <div style="display:flex; gap:10px; margin-bottom:15px;">
    <select id="chart-mode">
      <option value="day">Theo ngày</option>
      <option value="month">Theo tháng</option>
      <option value="year">Theo năm</option>
    </select>

    <input id="from-date" type="date">
    <input id="to-date" type="date">

    <button class="ctrl-btn" onclick="loadChartData()">Xem</button>
  </div>

  <canvas id="chartTemp" height="120"></canvas>
  <canvas id="chartHum" height="120" style="margin-top:20px"></canvas>
  <canvas id="chartLux" height="120" style="margin-top:20px"></canvas>
</section>

<!-- LỊCH SỬ 10 BẢN GHI GẦN NHẤT -->
<section class="card">
  <h2>Lịch sử 10 bản ghi gần nhất</h2>

  <table id="historyTable">
    <thead>
      <tr>
        <th>Thời gian</th>
        <th>Nhiệt độ</th>
        <th>Độ ẩm</th>
        <th>Ánh sáng</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>


      <h3 style="margin-top:30px">Lịch sử 10 bản ghi gần nhất</h3>
      <table id="historyTable">
        <thead>
          <tr>
            <th>Thời gian</th>
            <th>Nhiệt độ</th>
            <th>Độ ẩm</th>
            <th>Ánh sáng</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </div>

  <script src="script.js"></script>
</body>
</html>
